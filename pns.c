#include <stdio.h>
#include <stdlib.h>
#include <sys/time.h>

int main(int argc, char *argv[]) {

	if(argc != 2) {
        printf("Generate a printable [CAKI] nop slede");
		printf("  Usage: %s <length>\n", argv[0]);
		return 0;
	}
    
    int length = atoi(argv[1]);
    
    if (length & 1 || length <= 0) {
		printf("Length must be an even number (> 0).\n");
		return 0;
    }

    int count[4] = { length / 4, length / 4, (length + 2) / 4, (length + 2) / 4 };
    const int ops[4] = { 
        0x43,   /* inc ebx */
        0x4B,   /* dec ebx */
        0x41,   /* inc ecx */
        0x49 }; /* dec ecx */

	/* Seed the pseudo-random sequence */
	struct timeval t1;
	gettimeofday(&t1, NULL);
	srandom(t1.tv_usec * t1.tv_sec);

    /* Start spiting out matched instructions */
    while ( count[0] > 0 || count[1] > 0 || count[2] > 0 || count[3] > 0 ) {
        int i = random() % 4;
        if (count[i] > 0) {
            printf("%c", ops[i]);
            --count[i];
        }
    }
    return 0;
}
